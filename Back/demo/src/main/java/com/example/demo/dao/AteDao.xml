<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.AteDao">
	
	<insert id="add" parameterType="map" useGeneratedKeys="true"
		keyProperty="ate_num">
		insert into ate 
		set RCP_SEQ=#{RCP_SEQ}, mnum=#{mnum}, ate_date=now(),
		ate_picture=#{ate_picture}, ate_content=#{ate_content}
	</insert>

	<select id="get" parameterType="Integer" resultType="Ate">
		select * from ate
	</select>
	
	<select id="getOne" parameterType="Integer" resultType="Ate">
		select * from ate where ate_num=#{ate_num}
	</select>
	
	
	<update id="editAte" parameterType="map">
		UPDATE ate
		set ate_editdate=now(),
		ate_picture=#{ate_picture}, ate_content=#{ate_content}
		WHERE ate_num = #{ate_num} and mnum =#{mnum}
	</update>
	
	<delete id="delete" parameterType="Integer">
		DELETE FROM ate WHERE ate_num = #{ate_num} and mnum =#{mnum};
	</delete>
	
	<update id="upHit" parameterType="Integer">
		UPDATE ate
		SET ate_hit = ate_hit + 1
		WHERE ate_num = #{ate_num}
	</update>
	
	<select id="ateLike" parameterType="int" resultType="int">
		select count(*) from ate_like where ate_num=#{ate_num} and mnum=#{mnum}
	</select>
	
	<insert id="goAteLike" parameterType="Integer">		
		insert into ate_like
		set 
		ate_num=#{ate_num}, 
		mnum=#{mnum}, 
		RCP_SEQ = (select RCP_SEQ from ate where ate_num=#{ate_num} and mnum=#{mnum})
	</insert>
	
	<delete id="goAteDislike" parameterType="Integer">
		DELETE FROM ate_like
		WHERE ate_num=#{ate_num} and mnum=#{mnum} and
		RCP_SEQ = (select RCP_SEQ from ate where ate_num=#{ate_num} and mnum=#{mnum})
		
	</delete>
	
	
	
</mapper>